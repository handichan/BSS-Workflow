"MSHP, SEER 29.3, 14 HSPF",
"ASHP, SEER 10, 6.2 HSPF",
"ASHP, SEER 13, 7.7 HSPF",
"ASHP, SEER 15, 8.5 HSPF",
"Shared Heating",
"Fuel Boiler, 90% AFUE",
"Fuel Boiler, 80% AFUE",
# "Fuel Furnace, 76% AFUE",
"Fuel Furnace, 80% AFUE",
"Fuel Furnace, 92.5% AFUE"
)
(existing %>% filter(in.hvac_heating_efficiency %in% eff_heat) %>% nrow())/nrow(existing)
eff_cool<-c(
"Ducted Heat Pump",
"Shared Cooling",
"None",
"AC, SEER 13",
"AC, SEER 15",
"Room AC, EER 10.7",
"Room AC, EER 12.0",
"Non-Ducted Heat Pump")
# max possible -------------------------------------------------------------------------
eff_heat<-c(
"MSHP, SEER 14.5, 8.2 HSPF",
"MSHP, SEER 29.3, 14 HSPF",
# "ASHP, SEER 10, 6.2 HSPF",
"ASHP, SEER 13, 7.7 HSPF",
"ASHP, SEER 15, 8.5 HSPF",
"Shared Heating",
"Fuel Boiler, 90% AFUE",
"Fuel Boiler, 80% AFUE",
# "Fuel Furnace, 76% AFUE",
"Fuel Furnace, 80% AFUE",
"Fuel Furnace, 92.5% AFUE"
)
(existing %>% filter(in.hvac_heating_efficiency %in% eff_heat, in.hvac_cooling_efficiency %in% eff_cool) %>% nrow())/nrow(existing)
(existing %>% filter(in.hvac_heating_efficiency %in% eff_heat, in.hvac_cooling_efficiency %in% eff_cool) %>%
select(bldg_id) %>%
inner_join(std_env %>% filter(!applicability)) %>% nrow())/nrow(existing)
(existing %>% filter(in.hvac_heating_efficiency %in% eff_heat, in.hvac_cooling_efficiency %in% eff_cool, in.lighting=="100% LED") %>%
select(bldg_id) %>%
inner_join(std_env %>% filter(!applicability)) %>% nrow())/nrow(existing)
(existing %>% filter(in.hvac_heating_efficiency %in% eff_heat, in.hvac_cooling_efficiency %in% eff_cool, in.lighting!="100% Incandescent") %>%
select(bldg_id) %>%
inner_join(std_env %>% filter(!applicability)) %>% nrow())/nrow(existing)
summary(factor(meta_res_2024$in.water_heater_efficiency))
#2024.1 metadata
existing<-read_parquet("/Users/mpigman/Documents/EULP downloads/ResStock/2024/2024.1/baseline_metadata_and_annual_results.parquet",
col_select = c(bldg_id,upgrade,
out.electricity.mech_vent.energy_consumption.kwh,
out.natural_gas.clothes_dryer.energy_consumption.kwh,
out.electricity.clothes_washer.energy_consumption.kwh,
out.electricity.clothes_dryer.energy_consumption.kwh,
out.electricity.dishwasher.energy_consumption.kwh,
out.electricity.refrigerator.energy_consumption.kwh,
out.propane.clothes_dryer.energy_consumption.kwh,
out.electricity.lighting_interior.energy_consumption.kwh,
out.electricity.lighting_exterior.energy_consumption.kwh,
out.electricity.lighting_garage.energy_consumption.kwh,
out.electricity.heating_hp_bkup.energy_consumption.kwh,
out.electricity.heating_hp_bkup_fa.energy_consumption.kwh,
out.electricity.cooling_fans_pumps.energy_consumption.kwh,
out.electricity.cooling.energy_consumption.kwh,
out.electricity.heating.energy_consumption.kwh,
out.natural_gas.heating.energy_consumption.kwh,
out.natural_gas.heating_hp_bkup.energy_consumption.kwh,
out.propane.heating.energy_consumption.kwh,
out.propane.heating_hp_bkup.energy_consumption.kwh,
out.fuel_oil.heating.energy_consumption.kwh,
out.fuel_oil.heating_hp_bkup.energy_consumption.kwh,
out.electricity.heating_fans_pumps.energy_consumption.kwh,
out.electricity.pv.energy_consumption.kwh,
out.electricity.hot_water.energy_consumption.kwh,
out.natural_gas.hot_water.energy_consumption.kwh,
out.fuel_oil.hot_water.energy_consumption.kwh,
out.propane.hot_water.energy_consumption.kwh,
out.electricity.range_oven.energy_consumption.kwh,
out.natural_gas.range_oven.energy_consumption.kwh,
out.propane.range_oven.energy_consumption.kwh,
out.electricity.plug_loads.energy_consumption.kwh,
contains("total.energy_consumption"),
in.hvac_cooling_efficiency,
in.hvac_cooling_partial_space_conditioning,
in.hvac_has_ducts,
in.hvac_heating_efficiency,
in.heating_fuel,
in.water_heater_fuel,
in.water_heater_efficiency,
in.cooking_range,
in.lighting,
in.clothes_washer,
in.clothes_dryer,
in.dishwasher,
in.ashrae_iecc_climate_zone_2004,
in.geometry_building_type_recs,
in.vintage,
in.state,
in.county,
in.sqft,
in.income,
in.occupants,
out.bills.all_fuels.usd,
contains("setpoint"),
contains("marginal_rates"),
contains("fixed_charges")
)) %>% filter(in.occupants != "0") %>%
mutate(NHSLDMEM=if_else(in.occupants %in% c("7","8","9","10+"),7,as.numeric(in.occupants)))
summary(factor(existing$in.water_heater_efficiency))
recs_rates<-recs_zip %>% filter(SOLAR!=1) %>% group_by(state_postal) %>%
summarize(KWH=sum(KWH),DOLLAREL=sum(DOLLAREL),BTUNG=sum(BTUNG),DOLLARNG=sum(DOLLARNG),BTULP=sum(BTULP),DOLLARLP=sum(DOLLARLP),BTUFO=sum(BTUFO),DOLLARFO=sum(DOLLARFO)) %>%
mutate(elec_per_kwh=DOLLAREL/KWH,gas_per_kwh=DOLLARNG/BTUNG*3.412,pro_per_kwh=DOLLARLP/BTULP*3.412,fo_per_kwh=DOLLARFO/BTUFO*3.412) %>%
ungroup()
recs_rates
replace_1_05 %>% filter(applicability,in.state=="CA") %>%
left_join(recs_rates %>% select(state_postal, contains("per_kwh")),by=c("in.state"="state_postal")) %>%
mutate(cost_elec = (out.electricity.total.energy_consumption.kwh - out.electricity.plug_loads.energy_consumption.kwh) * elec_per_kwh,
cost_ng = out.natural_gas.total.energy_consumption.kwh * gas_per_kwh,
cost_prop = out.propane.total.energy_consumption.kwh * pro_per_kwh,
cost_fo = out.fuel_oil.total.energy_consumption.kwh * fo_per_kwh,
cost_total_no_mels = sum(cost_elec,cost_ng,cost_prop,cost_fo,na.rm=T))
replace_1_05 %>% filter(applicability, in.state=="NV") %>%
left_join(recs_rates %>% select(state_postal, contains("per_kwh")),by=c("in.state"="state_postal")) %>%
mutate(cost_elec = (out.electricity.total.energy_consumption.kwh - out.electricity.plug_loads.energy_consumption.kwh) * elec_per_kwh,
cost_ng = out.natural_gas.total.energy_consumption.kwh * gas_per_kwh,
cost_prop = out.propane.total.energy_consumption.kwh * pro_per_kwh,
cost_fo = out.fuel_oil.total.energy_consumption.kwh * fo_per_kwh,
cost_total_no_mels = sum(cost_elec,cost_ng,cost_prop,cost_fo,na.rm=T),
cost_total_no_mels_per_sf = cost_total_no_mels/in.sqft) %>% select(contains("cost_"))
replace_1_05 %>% filter(applicability, in.state=="NV") %>%
left_join(recs_rates %>% select(state_postal, contains("per_kwh")),by=c("in.state"="state_postal")) %>%
mutate(cost_elec = (out.electricity.total.energy_consumption.kwh - out.electricity.plug_loads.energy_consumption.kwh) * elec_per_kwh,
cost_ng = out.natural_gas.total.energy_consumption.kwh * gas_per_kwh,
cost_prop = out.propane.total.energy_consumption.kwh * pro_per_kwh,
cost_fo = out.fuel_oil.total.energy_consumption.kwh * fo_per_kwh,
cost_total_no_mels = sum(cost_elec,cost_ng,cost_prop,cost_fo,na.rm=T),
cost_total_no_mels_per_sf = cost_total_no_mels/in.sqft) %>% select(cost_elec:cost_total_no_mels_per_sf)
summary(recs_rates)
replace_1_05 %>% filter(applicability, in.state=="NV") %>%
left_join(recs_rates %>% select(state_postal, contains("per_kwh")),by=c("in.state"="state_postal")) %>%
mutate(cost_elec = (out.electricity.total.energy_consumption.kwh - out.electricity.plug_loads.energy_consumption.kwh) * elec_per_kwh,
cost_ng = out.natural_gas.total.energy_consumption.kwh * gas_per_kwh,
cost_prop = out.propane.total.energy_consumption.kwh * pro_per_kwh,
cost_fo = out.fuel_oil.total.energy_consumption.kwh * fo_per_kwh,
cost_total_no_mels = cost_elec + cost_ng + cost_prop + if_else(is.na(cost_fo),0,cost_fo),
cost_total_no_mels_per_sf = cost_total_no_mels/in.sqft) %>% select(cost_elec:cost_total_no_mels_per_sf)
replace_1_05 %>% filter(applicability) %>%
left_join(recs_rates %>% select(state_postal, contains("per_kwh")),by=c("in.state"="state_postal")) %>%
mutate(cost_elec = (out.electricity.total.energy_consumption.kwh - out.electricity.plug_loads.energy_consumption.kwh) * elec_per_kwh,
cost_ng = out.natural_gas.total.energy_consumption.kwh * gas_per_kwh,
cost_prop = out.propane.total.energy_consumption.kwh * pro_per_kwh,
cost_fo = out.fuel_oil.total.energy_consumption.kwh * fo_per_kwh,
cost_total_no_mels = cost_elec + cost_ng + cost_prop + if_else(is.na(cost_fo),0,cost_fo),
cost_total_no_mels_per_sf = cost_total_no_mels/in.sqft) %>%
ggplot(aes(x=in.state,y=cost_total_no_mels_per_sf))+
geom_boxplot() +
facet_wrap(~in.ashrae_iecc_climate_zone_2004,scales="free")
per_sf<-replace_1_05 %>% filter(applicability) %>%
left_join(recs_rates %>% select(state_postal, contains("per_kwh")),by=c("in.state"="state_postal")) %>%
mutate(cost_elec = (out.electricity.total.energy_consumption.kwh - out.electricity.plug_loads.energy_consumption.kwh) * elec_per_kwh,
cost_ng = out.natural_gas.total.energy_consumption.kwh * gas_per_kwh,
cost_prop = out.propane.total.energy_consumption.kwh * pro_per_kwh,
cost_fo = out.fuel_oil.total.energy_consumption.kwh * fo_per_kwh,
cost_total_no_mels = cost_elec + cost_ng + cost_prop + if_else(is.na(cost_fo),0,cost_fo),
cost_total_no_mels_per_sf = cost_total_no_mels/in.sqft)
per_sf %>% select(in.state,in.ashrae_iecc_climate_zone_2004,cost_elec:cost_total_no_mels_per_sf)
per_sf %>%
ggplot(aes(x=in.ashrae_iecc_climate_zone_2004,y=cost_total_no_mels_per_sf))+
geom_boxplot()
per_sf
per_sf<-per_sf %>% select(in.state,in.ashrae_iecc_climate_zone_2004,cost_elec:cost_total_no_mels_per_sf)
per_sf
summary(per_sf)
per_sf %>%
group_by(in.ashrae_iecc_climate_zone_2004) %>%
summarize(mn=mean(cost_total_no_mels_per_sf),md=median(cost_total_no_mels_per_sf),minimum=min(cost_total_no_mels_per_sf),maximum=max(cost_total_no_mels_per_sf))
per_sf %>%
filter(in.cooling_setpoint %in% c("74F","75F","76F","77F","78F"),in.heating_setpoint %in% c("68F","69F","70F","71F","72F")) %>%
group_by(in.ashrae_iecc_climate_zone_2004) %>%
summarize(mn=mean(cost_total_no_mels_per_sf),md=median(cost_total_no_mels_per_sf),minimum=min(cost_total_no_mels_per_sf),maximum=max(cost_total_no_mels_per_sf),n=n())
per_sf<-replace_1_05 %>% filter(applicability) %>%
left_join(recs_rates %>% select(state_postal, contains("per_kwh")),by=c("in.state"="state_postal")) %>%
mutate(cost_elec = out.electricity.total.energy_consumption.kwh * elec_per_kwh,
cost_elec_no_mels = (out.electricity.total.energy_consumption.kwh - out.electricity.plug_loads.energy_consumption.kwh) * elec_per_kwh,
cost_ng = out.natural_gas.total.energy_consumption.kwh * gas_per_kwh,
cost_prop = out.propane.total.energy_consumption.kwh * pro_per_kwh,
cost_fo = out.fuel_oil.total.energy_consumption.kwh * fo_per_kwh,
cost_total_no_mels = cost_elec_no_mels + cost_ng + cost_prop + if_else(is.na(cost_fo),0,cost_fo),
cost_total_no_mels_per_sf = cost_total_no_mels/in.sqft) %>%
select(in.state,in.ashrae_iecc_climate_zone_2004,cost_elec:cost_total_no_mels_per_sf,in.cooling_setpoint,in.heating_setpoint)
per_sf %>%
filter(in.cooling_setpoint %in% c("74F","75F","76F","77F","78F"),in.heating_setpoint %in% c("68F","69F","70F","71F","72F")) %>%
group_by(in.ashrae_iecc_climate_zone_2004) %>%
summarize(mn=mean(cost_total_no_mels_per_sf),md=median(cost_total_no_mels_per_sf),minimum=min(cost_total_no_mels_per_sf),maximum=max(cost_total_no_mels_per_sf),n=n())
per_sf %>%
group_by(in.ashrae_iecc_climate_zone_2004) %>%
summarize(mn=mean(cost_total_no_mels_per_sf),md=median(cost_total_no_mels_per_sf),minimum=min(cost_total_no_mels_per_sf),maximum=max(cost_total_no_mels_per_sf),n=n())
sum_all<-per_sf %>%
group_by(in.ashrae_iecc_climate_zone_2004) %>%
summarize(mn=mean(cost_total_no_mels_per_sf),md=median(cost_total_no_mels_per_sf),minimum=min(cost_total_no_mels_per_sf),maximum=max(cost_total_no_mels_per_sf),n=n())
sum_sepoint<-per_sf %>%
filter(in.cooling_setpoint %in% c("74F","75F","76F","77F","78F"),in.heating_setpoint %in% c("68F","69F","70F","71F","72F")) %>%
group_by(in.ashrae_iecc_climate_zone_2004) %>%
summarize(mn=mean(cost_total_no_mels_per_sf),md=median(cost_total_no_mels_per_sf),minimum=min(cost_total_no_mels_per_sf),maximum=max(cost_total_no_mels_per_sf),n=n())
sum_all %>% full_join(sum_setpoint, by=c("in.ashrae_iecc_climate_zone_2004"),suffix = c("all","restricted"))
sum_all<-per_sf %>%
group_by(in.ashrae_iecc_climate_zone_2004) %>%
summarize(mn=mean(cost_total_no_mels_per_sf),md=median(cost_total_no_mels_per_sf),minimum=min(cost_total_no_mels_per_sf),maximum=max(cost_total_no_mels_per_sf),n=n())
sum_sepoint<-per_sf %>%
filter(in.cooling_setpoint %in% c("74F","75F","76F","77F","78F"),in.heating_setpoint %in% c("68F","69F","70F","71F","72F")) %>%
group_by(in.ashrae_iecc_climate_zone_2004) %>%
summarize(mn=mean(cost_total_no_mels_per_sf),md=median(cost_total_no_mels_per_sf),minimum=min(cost_total_no_mels_per_sf),maximum=max(cost_total_no_mels_per_sf),n=n())
sum_all %>% full_join(sum_setpoint, by=c("in.ashrae_iecc_climate_zone_2004"),suffix = c("all","restricted"))
sum_setpoint<-per_sf %>%
filter(in.cooling_setpoint %in% c("74F","75F","76F","77F","78F"),in.heating_setpoint %in% c("68F","69F","70F","71F","72F")) %>%
group_by(in.ashrae_iecc_climate_zone_2004) %>%
summarize(mn=mean(cost_total_no_mels_per_sf),md=median(cost_total_no_mels_per_sf),minimum=min(cost_total_no_mels_per_sf),maximum=max(cost_total_no_mels_per_sf),n=n())
sum_all %>% full_join(sum_setpoint, by=c("in.ashrae_iecc_climate_zone_2004"),suffix = c("all","restricted"))
sum_all %>% full_join(sum_setpoint, by=c("in.ashrae_iecc_climate_zone_2004"),suffix = c(".all",".restricted"))
per_sf %>%
ggplot(aes(x=in.ashrae_iecc_climate_zone_2004,y=cost_total_no_mels_per_sf))+
geom_boxplot()
write_csv(per_sf,"/Users/mpigman/Library/CloudStorage/GoogleDrive-mpigman@lbl.gov/Shared drives/Energy Poverty/data/ResStock/per_sf.csv")
per_sf<-replace_1_05 %>% filter(applicability) %>%
left_join(recs_rates %>% select(state_postal, contains("per_kwh")),by=c("in.state"="state_postal")) %>%
mutate(cost_elec = out.electricity.total.energy_consumption.kwh * elec_per_kwh,
cost_elec_no_mels = (out.electricity.total.energy_consumption.kwh - out.electricity.plug_loads.energy_consumption.kwh) * elec_per_kwh,
cost_ng = out.natural_gas.total.energy_consumption.kwh * gas_per_kwh,
cost_prop = out.propane.total.energy_consumption.kwh * pro_per_kwh,
cost_fo = out.fuel_oil.total.energy_consumption.kwh * fo_per_kwh,
cost_total_no_mels = cost_elec_no_mels + cost_ng + cost_prop + if_else(is.na(cost_fo),0,cost_fo),
cost_total_no_mels_per_sf = cost_total_no_mels/in.sqft) %>%
select(in.state,in.ashrae_iecc_climate_zone_2004,cost_elec:cost_total_no_mels_per_sf,in.cooling_setpoint,in.heating_setpoint, in.occupants,in.sqft,bldg_id)
write_csv(per_sf,"/Users/mpigman/Library/CloudStorage/GoogleDrive-mpigman@lbl.gov/Shared drives/Energy Poverty/data/ResStock/per_sf.csv")
recs_plus_mp_code %>% group_by(EQUIPAGE,ACEQUIPAGE) %>%
summarize(total=sum(NWEIGHT)) %>%
mutate(share=total/sum(total))
recs_plus_mp_code %>% group_by(EQUIPAGE,ACEQUIPAGE) %>%
summarize(total=sum(NWEIGHT)) %>%
ungroup() %>%
mutate(share=total/sum(total))
recs_plus_mp_code %>% group_by(EQUIPAGE,ACEQUIPAGE) %>%
summarize(total=sum(NWEIGHT)) %>%
ungroup() %>%
mutate(share=total/sum(total)) %>%
arrange(desc(share))
recs_plus_mp_code %>% group_by(EQUIPAGE,ACEQUIPAGE) %>%
summarize(total=sum(NWEIGHT)) %>%
ungroup() %>%
mutate(share=total/sum(total)) %>%
ggplot(aes(x=EQUIPAGE,y=ACEQUIPAGE,fill=share))+
geom_tile()
recs_plus_mp_code %>% group_by(EQUIPAGE,ACEQUIPAGE) %>%
summarize(total=sum(NWEIGHT)) %>%
ungroup() %>%
mutate(share=total/sum(total)) %>%
ggplot(aes(x=EQUIPAGE,y=ACEQUIPAGE,fill=share))+
geom_tile()+
scale_fill_gradient(low="white",high="black")
ages<-recs_plus_mp_code %>% group_by(EQUIPAGE,ACEQUIPAGE) %>%
summarize(total=sum(NWEIGHT)) %>%
ungroup() %>%
mutate(share=total/sum(total))
ages %>% filter(EQUIPAGE %in% 1:3, ACEQUIPAGE %in% 1:3) %>% colSums()
ages %>% filter(EQUIPAGE %in% 1:2, ACEQUIPAGE %in% 1:2) %>% colSums()
(existing %>% filter(in.hvac_heating_efficiency %in% eff_heat) %>% nrow())/nrow(existing)
(existing %>% filter(in.hvac_cooling_efficiency %in% eff_cool) %>% nrow())/nrow(existing)
(existing %>% filter(in.hvac_heating_efficiency %in% eff_heat, in.hvac_cooling_efficiency %in% eff_cool) %>% nrow())/nrow(existing)
(existing %>% filter(in.hvac_heating_efficiency %in% eff_heat, in.hvac_cooling_efficiency %in% eff_cool) %>%
select(bldg_id) %>%
inner_join(std_env %>% filter(!applicability)) %>% nrow())/nrow(existing)
colnames(sp)
setwd("/Users/mpigman/Library/CloudStorage/GoogleDrive-mpigman@lbl.gov/Shared drives/Buildings Policy Analysis Team/Projects/Buildings Sector Scenarios/v2_diagnostics/calc_annual_results")
for (file in list.files()){
if (file=="scout_annual_state_aeo.tsv") {
wide<-bind_rows(wide,read_tsv(file))
} else{
wide<-bind_rows(wide,read_tsv(file) %>% filter(turnover!="baseline"))
}
}
#load required packages
library(tidyverse)
library(scales)
theme_set(theme_bw())
for (file in list.files()){
if (file=="scout_annual_state_aeo.tsv") {
wide<-bind_rows(wide,read_tsv(file))
} else{
wide<-bind_rows(wide,read_tsv(file) %>% filter(turnover!="baseline"))
}
}
# Scout results - output of calc_annual
wide<-data.frame()
for (file in list.files()){
if (file=="scout_annual_state_aeo.tsv") {
wide<-bind_rows(wide,read_tsv(file))
} else{
wide<-bind_rows(wide,read_tsv(file) %>% filter(turnover!="baseline"))
}
}
setwd("/Users/mpigman/Documents/GitHub/BSS-Workflow/R")
# nice names for the Scout measures
mm<-read_tsv("../map_meas/measure_map.tsv")
mm_long<-pivot_longer(mm %>% select(-c(original_ann:measure_ts)) %>% rename(measure_ann=measure_desc_simple,original_ann=original_desc_simple),
names_to="tech_stage",values_to="description",original_ann:measure_ann)
# for nice labeling
# Scout scenarios -- every value of "turnover" should be here
# this is the order they'll be shown in facet plots, etc
to<-c(baseline="AEO 2023",aeo="AEO 2025",ref="Stated Policies",stated_policies="Stated Policies",
state="State and Local Action",mid="Mid",high="High",accel="Accelerated Innovation",
fossil="High Fuel Demand",breakthrough="Breakthrough",brk="Breakthrough",ineff="Inefficient")
# sector
s<-c(com="Commercial",res="Residential",all="All Buildings")
# end uses
eu<-c(`Computers and Electronics`="Computers and Electronics",Cooking="Cooking",`Cooling (Equip.)`="Cooling",`Heating (Equip.)`="Heating",
Lighting="Lighting",Other="Other",Refrigeration="Refrigeration",Ventilation="Ventilation",`Water Heating`="Water Heating")
#fill colors
colors<-c("#e41a1c","#fbb4ae",
"#377eb8","#b3cde3",
"#4daf4a","#ccebc5",
"#984ea3","#decbe4",
"#ff7f00","#fed9a6",
"#ffee33","#ffffcc",
"#a65628","#e5d8bd",
"#f781bf","#fddaec",
"#999999","#f2f2f2",
"#5b92e5","#d4a017", "#8fbc8f","#ff69b4")
#width changeable based on number of scenarios
width<-(1+length(unique(wide$turnover)))*1.8
# states to show as examples for heating and cooling
states<-c("WA","CA","MA","FL")
state_height<-length(states)*1.4
# order the scenarios for plotting
wide<-wide %>% mutate(turnover=factor(turnover,levels=to,ordered=T))
to
names(to)
# order the scenarios for plotting
wide<-wide %>% mutate(turnover=factor(turnover,levels=names(to),ordered=T))
print("printing 1")
# area plot by year, scenario, end use, sector
wide %>% filter(fuel=="Electric") %>%
group_by(year,sector,end_use,turnover) %>%
summarize(kwh=sum(state_ann_kwh)/10^9) %>%
ggplot(aes(x=year,y=kwh,fill=end_use))+
geom_area() +
facet_grid(sector~turnover,labeller = labeller(turnover=to,sector=s))+
scale_y_continuous("TWh",labels=comma_format(),expand=expansion(add=0,mult=c(0,.05)))+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(name="",labels=eu,values=colors)+
theme(strip.background = element_blank(),strip.text.y = element_text(angle=-90,size=12),strip.text.x = element_text(size=12))
ggsave("graphs/national_annual_sector_scenario.jpeg",device = "jpeg",width = width, height =3,units = "in")
print("printing 2")
# line plot comparing the scenario totals
wide %>% filter(fuel=="Electric") %>%
group_by(turnover,year) %>% summarize(TWh=sum(state_ann_kwh)/10^9) %>%
ggplot(aes(x=year,y=TWh,color=turnover))+
geom_line()+
scale_y_continuous(limits=c(0,NA),labels=comma_format())+
scale_color_manual(values =colors,name="",labels=to)+
xlab("")
ggsave("graphs/national_annual_lines.jpeg",device = "jpeg",width = 4.5, height =3,units = "in")
with_shapes<-wide %>% filter(fuel=="Electric") %>%
left_join(mm_long, by=c("meas","end_use"="Scout_end_use","tech_stage","sector"))
with_shapes_agg <-with_shapes  %>% group_by(year,end_use,turnover,sector,description) %>% summarize(TWh=sum(state_ann_kwh)/10^9) %>% ungroup()
print("printing 3")
#HVAC
for (s in c("com","res")){
with_shapes_agg%>%  group_by(description) %>% filter(sum(TWh)>0) %>%
filter((end_use %in% c("Cooling (Equip.)","Heating (Equip.)","Ventilation")),sector==s) %>%
ggplot(aes(x=year,y=TWh,fill=description)) +
geom_area()+
facet_grid(end_use~turnover,labeller = labeller(turnover=to,end_use=eu))+
scale_y_continuous("TWh",expand=expansion(add=0,mult=c(0,.05)),labels=comma_format())+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(values=colors,name="")+
theme(strip.background = element_blank(),strip.text.y = element_text(angle=-90,size=12),strip.text.x = element_text(size=12))
ggsave(paste0("graphs/national_annual_",s,"_hvac.jpeg"),device = "jpeg",width = width, height =4,units = "in")
}
print("printing 4")
#water heating
for (s in c("com","res")){
with_shapes_agg%>%  group_by(description) %>% filter(sum(TWh)>0) %>%
filter((end_use %in% c("Water Heating")),sector==s) %>%
ggplot(aes(x=year,y=TWh,fill=description)) +
geom_area()+
facet_grid(~turnover,labeller = labeller(turnover=to,end_use=eu))+
scale_y_continuous("TWh",expand=expansion(add=0,mult=c(0,.05)),labels=comma_format())+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(values=colors,name="")+
theme(strip.background = element_blank(),strip.text.y = element_text(angle=-90,size=12),strip.text.x = element_text(size=12))
ggsave(paste0("graphs/national_annual_",s,"_wh.jpeg"),device = "jpeg",width = width, height =4/1.5,units = "in")
}
print("printing 5")
#non HVAC, non-WH
for (s in c("com","res")){
with_shapes_agg%>%  group_by(description) %>% filter(sum(TWh)>0) %>%
filter(!(end_use %in% c("Water Heating","Heating (Equip.)","Cooling (Equip.)","Ventilation")),sector==s) %>%
ggplot(aes(x=year,y=TWh,fill=description)) +
geom_area()+
facet_grid(~turnover,labeller = labeller(turnover=to,end_use=eu))+
scale_y_continuous("TWh",expand=expansion(add=0,mult=c(0,.05)),labels=comma_format())+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(values=colors,name="")+
theme(strip.background = element_blank(),strip.text.y = element_text(angle=-90,size=12),strip.text.x = element_text(size=12))
ggsave(paste0("graphs/national_annual_",s,"_non-mech.jpeg"),device = "jpeg",width = width, height =4/1.15,units = "in")
}
print("printing 6")
with_shapes_agg_state <-with_shapes %>% filter(reg %in% states) %>%
group_by(year,reg,end_use,turnover,sector,description) %>%
summarize(TWh=sum(state_ann_kwh)/10^9) %>%
ungroup()
for(s in c("res","com")){
for (u in c("Heating (Equip.)","Cooling (Equip.)")){
with_shapes_agg_state%>%
group_by(description) %>% filter(sum(TWh)>0) %>%
filter(end_use ==u,sector==s) %>%
ggplot(aes(x=year,y=TWh,fill=description)) +
geom_area()+
facet_grid(reg~turnover,labeller = labeller(turnover=to,end_use=eu),scales="free")+
scale_y_continuous("TWh",expand=expansion(add=0,mult=c(0,.05)))+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(values=colors,name="")+
theme(strip.background = element_blank(),strip.text.y = element_text(angle=-90,size=12),strip.text.x = element_text(size=12))
ggsave(paste0("graphs/state_annual_",s,"_",eu[u],".jpeg"),device = "jpeg",width = width, height =state_height,units = "in")
}
}
unique(wide$fuel)
wide %>% filter(sector=="com",end_use=="Other") %>% group_by(turnover,fuel) %>% summarize(total=sum(state_ann_kwh))
wide %>% filter(sector=="com",end_use=="Other",year==2025) %>% group_by(turnover,fuel) %>% summarize(total=sum(state_ann_kwh))
wide %>% filter(sector=="com",end_use=="Other",year==2026) %>% group_by(turnover,fuel) %>% summarize(total=sum(state_ann_kwh))
wide %>% filter(sector=="com",end_use=="Other",year==2050) %>% group_by(turnover,fuel) %>% summarize(total=sum(state_ann_kwh))
with_shapes_agg%>%  group_by(description) %>% filter(sum(TWh)>0) %>%
filter(!(end_use %in% c("Water Heating","Heating (Equip.)","Cooling (Equip.)","Ventilation")),sector=="res") %>%
ggplot(aes(x=year,y=TWh,fill=description)) +
geom_area()+
facet_grid(~turnover,labeller = labeller(turnover=to,end_use=eu))+
scale_y_continuous("TWh",expand=expansion(add=0,mult=c(0,.05)),labels=comma_format())+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(values=colors,name="")+
theme(strip.background = element_blank(),strip.text.y = element_text(angle=-90,size=12),strip.text.x = element_text(size=12))
with_shapes_agg%>%  group_by(description) %>% filter(sum(TWh)>0) %>%
filter(!(end_use %in% c("Water Heating","Heating (Equip.)","Cooling (Equip.)","Ventilation")),sector=="res") %>%
ggplot(aes(x=year,y=TWh,fill=description)) +
geom_area()+
facet_grid(~turnover,labeller = labeller(turnover=to,end_use=eu))+
scale_y_continuous("TWh",expand=expansion(add=0,mult=c(0,.05)),labels=comma_format())+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(values=colors,name="")+
theme(strip.background = element_blank(),strip.text.y = element_text(angle=-90,size=12),strip.text.x = element_text(size=12),guide_legend(ncol = 2))
with_shapes_agg%>%  group_by(description) %>% filter(sum(TWh)>0) %>%
filter(!(end_use %in% c("Water Heating","Heating (Equip.)","Cooling (Equip.)","Ventilation")),sector=="res") %>%
ggplot(aes(x=year,y=TWh,fill=description)) +
geom_area()+
facet_grid(~turnover,labeller = labeller(turnover=to,end_use=eu))+
scale_y_continuous("TWh",expand=expansion(add=0,mult=c(0,.05)),labels=comma_format())+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(values=colors,name="")+
theme(guide_legend(ncol = 2))
with_shapes_agg%>%  group_by(description) %>% filter(sum(TWh)>0) %>%
filter(!(end_use %in% c("Water Heating","Heating (Equip.)","Cooling (Equip.)","Ventilation")),sector=="res") %>%
ggplot(aes(x=year,y=TWh,fill=description)) +
geom_area()+
facet_grid(~turnover,labeller = labeller(turnover=to,end_use=eu))+
scale_y_continuous("TWh",expand=expansion(add=0,mult=c(0,.05)),labels=comma_format())+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(values=colors,name="",guides=guide(guide_legend(ncol=2)))+
theme(strip.background = element_blank(),strip.text.y = element_text(angle=-90,size=12),strip.text.x = element_text(size=12))
with_shapes_agg%>%  group_by(description) %>% filter(sum(TWh)>0) %>%
filter(!(end_use %in% c("Water Heating","Heating (Equip.)","Cooling (Equip.)","Ventilation")),sector=="res") %>%
ggplot(aes(x=year,y=TWh,fill=description)) +
geom_area()+
facet_grid(~turnover,labeller = labeller(turnover=to,end_use=eu))+
scale_y_continuous("TWh",expand=expansion(add=0,mult=c(0,.05)),labels=comma_format())+
scale_x_continuous(name="",expand=c(0,0),breaks=seq(2030,2050,by=10))+
scale_fill_manual(values=colors,name="",guides=guide_legend(ncol=2))+
theme(strip.background = element_blank(),strip.text.y = element_text(angle=-90,size=12),strip.text.x = element_text(size=12))
#meta_res<-read_parquet("/Users/mpigman/Documents/EULP downloads/ResStock/2022/release 1.1/baseline_metadata_and_annual_results.parquet")
meta_com<-read_parquet("/Users/mpigman/Documents/EULP downloads/ComStock/2024/meta_baseline.parquet")
library(arrow)
#meta_res<-read_parquet("/Users/mpigman/Documents/EULP downloads/ResStock/2022/release 1.1/baseline_metadata_and_annual_results.parquet")
meta_com<-read_parquet("/Users/mpigman/Documents/EULP downloads/ComStock/2024/meta_baseline.parquet")
meta_com %>% filter(!(in.state %in% c("AK","HI"))) %>% select(in.nhgis_county_gisjoin) %>% unique() %>% nrow()
meta_res_2024<-read_parquet("/Users/mpigman/Documents/EULP downloads/ResStock/2024/baseline.parquet")
length(unique(meta_res_2024$in.county))
meta_res_2024 %>% filter(in.county=="G0800110") %>% select(in.county_name) %>% head(1)
meta_res_2024 %>% group_by(in.weather_file_city,in.state) %>% summarize(n=n()) %>% nrow()
meta_res_2024 %>% filter(out.electricity.total.energy_consumption>0) %>% group_by(in.weather_file_city,in.state) %>% summarize(n=n()) %>% nrow()
meta_res_2024 %>% filter(out.electricity.heating.energy_consumption>0) %>% group_by(in.weather_file_city,in.state) %>% summarize(n=n()) %>% nrow()
unique(meta_res_2024$in.hvac_heating_efficiency)
meta_com %>% filter(in.state=="WV") %>% group_by(in.hvac_heat_type) %>% summarize(n=n())
meta_com %>% filter(in.state=="WV") %>% group_by(in.hvac_heat_type,in.heating_fuel) %>% summarize(n=n())
meta_com %>% filter(in.state=="WV") %>% group_by(in.heating_fuel,in.hvac_heat_type,in.hvac_cool_type) %>% summarize(n=n())
meta_com %>% filter(in.state=="WV") %>% group_by(in.heating_fuel,in.hvac_heat_type,in.hvac_cool_type) %>% summarize(n=n()) %>% filter(!(in.heating_fuel %in% c("Electricity","NaturalGas")))
meta_com %>% filter(in.state=="WV") %>% group_by(in.heating_fuel,in.hvac_heat_type,in.hvac_cool_type) %>% summarize(heatelec=sum(out.electricity.heating.energy_consumption)) %>% filter(!(in.heating_fuel %in% c("Electricity","NaturalGas")))
nrow(meta_res_2024 %>% filter(in.occupants=="0"))/nrow(meta_res_2024)
b<-read_tsv("/Users/mpigman/Library/CloudStorage/GoogleDrive-mpigman@lbl.gov/Shared drives/Buildings Policy Analysis Team/Projects/Buildings Sector Scenarios/v2_diagnostics/062725/df/brk df.tsv")
b %>% filter(value<0,metric=="Efficient Energy Use, Measure (MMBtu)")
b %>% filter(value<0,metric=="Efficient Energy Use, Measure (MMBtu)",fuel=="Electric")
b %>% filter(value<0,metric=="Efficient Energy Use, Measure (MMBtu)",fuel=="Electric") %>% select(meas) %>% unique()
b %>% filter(value<0,metric=="Efficient Energy Use, Measure (MMBtu)",fuel=="Electric") %>% select(reg) %>% unique()
b %>% filter(meas=="(R) Brk. HPWH FS",year==2040,reg=="CA",fuel=="Electric")
d<-b %>% pivot_wider(names_from="metric",values_from="value")
d
d %>% filter(fuel=="Electric",`Baseline Energy Use (MMBtu)`==0,`Efficient Energy Use (MMBtu)`!=`Efficient Energy Use, Measure (MMBtu)`)
d %>% filter(fuel=="Electric",`Baseline Energy Use (MMBtu)`==0,`Efficient Energy Use (MMBtu)`!=`Efficient Energy Use, Measure (MMBtu)`) %>% select(meas) %>% unique()
d %>% filter(fuel=="Electric",`Baseline Energy Use (MMBtu)`==0,`Efficient Energy Use (MMBtu)`>`Efficient Energy Use, Measure (MMBtu)`) %>% select(meas) %>% unique()
d %>% filter(fuel=="Electric",`Baseline Energy Use (MMBtu)`==0,`Efficient Energy Use (MMBtu)`<`Efficient Energy Use, Measure (MMBtu)`) %>% select(meas) %>% unique()
d %>% filter(fuel=="Electric",`Baseline Energy Use (MMBtu)`==0,`Efficient Energy Use (MMBtu)`<`Efficient Energy Use, Measure (MMBtu)`) %>% select(bldg_type) %>% unique()
d %>% filter(meas=="(R) Brk. HP FS (NG Boiler)",reg=="NV",year==2050)
d %>% filter(meas=="(R) Brk. HP FS (NG Boiler)",reg=="NV",year==2050,fuel=="Electric")
d %>% filter(meas %in% c("(R) Brk. HP FS (NG Boiler)","(R) Brk. HP FS (NG Boiler) & Env.++"),reg=="NV",year==2050,fuel=="Electric")
d %>% filter(meas %in% c("(R) Brk. HP FS (NG Boiler)","(R) Brk. HP FS (NG Boiler) & Env.++"),reg=="NV",year==2050,fuel=="Electric",end_use=="Heating (Equip.)")
d %>% filter(fuel=="Electric",`Baseline Energy Use (MMBtu)`==0,`Efficient Energy Use (MMBtu)`<`Efficient Energy Use, Measure (MMBtu)`) %>% select(year) %>% unique()
