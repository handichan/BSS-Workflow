ns<-read_csv("../map_meas/resstock_ns.csv")
#width for annual graphs changeable based on number of scenarios
width<-(1+length(scenarios))*1.8
#order the scenarios
county_ann_eu<-county_ann_eu %>% mutate(turnover=factor(turnover,levels=c("baseline",names(to[scenarios])),ordered=T))
county_100_hrs<-county_100_hrs %>% mutate(turnover=factor(turnover,levels=c("baseline",names(to[scenarios])),ordered=T))
county_monthly_maxes<-county_monthly_maxes %>% mutate(turnover=factor(turnover,levels=c("baseline",names(to[scenarios])),ordered=T))
# percent change in peak demand
# by turnover
peak_change<-county_100_hrs %>%
filter(turnover %in% scen_filtered, rank_num==1) %>%
pivot_wider(names_from=year,values_from=county_total_hourly_kwh,id_cols=c(in.county,turnover,in.state)) %>%
mutate(percent_change=`2050`/`2024`-1,
fill_color=color_interp(percent_change))
scen_filtered<-scenarios
# percent change in peak demand
# by turnover
peak_change<-county_100_hrs %>%
filter(turnover %in% scen_filtered, rank_num==1) %>%
pivot_wider(names_from=year,values_from=county_total_hourly_kwh,id_cols=c(in.county,turnover,in.state)) %>%
mutate(percent_change=`2050`/`2024`-1,
fill_color=color_interp(percent_change))
peak_change
county_100_hrs
county_100_hrs %>% filter(rank_num==1)
county_100_hrs %>% filter(rank_num==1,in.county=="G0600670")
datasets <- split(peak_change, list(droplevels(peak_change$turnover)))
datasets
county_100_hrs_share<-county_100_hrs %>%
filter(turnover %in% scen_filtered) %>%
mutate(month=month(timestamp_hour),season=case_when(month %in% 5:9 ~ "Summer", month %in% c(11,12,1,2) ~ "Winter", TRUE ~ "Shoulder")) %>%
group_by(turnover,year,in.county) %>%
mutate(share_winter=sum(season=="Winter")/100) %>%
filter(rank_num==1)
county_100_hrs_share
county_hourly_examples_list
county_hourly_examples_list[["aeo"]] %>% filter(in.county=="G3600810",year==2024)
county_hourly_examples_list[["aeo"]] %>% filter(in.county=="G3600810",year==2024,example_type=="High fossil heat")
297840/9
tmy_monthly<-read_csv("/Users/mpigman/Documents/DECARB/pipeline/Scout results/2025-09-17/tmy_state_monthly.csv")
tmy_monthly
bss_with_mult
bss_with_mult_long
with_tmy<-bind_rows(bss_with_mult_long,
tmy_monthly %>%
mutate(type="state_monthly_tmy") %>%
select(turnover,month,in.state,sector,type,kwh=state_monthly_kwh))
sct<-"res"
st<-"CA"
eia_gross %>%
filter(in.state==st,sector==sct,year %in% 2020:2024) %>%
ggplot(aes(x=month))+
geom_col(aes(y=gross.kWh))+
geom_point(data=bss_with_mult_long %>% filter(in.state==st,sector==sct,year %in% 2020:2024),aes(y=kwh,color=type))+
facet_wrap(~year,scales="free_y")+
ggtitle(paste(st,sct))
eia_gross %>%
filter(in.state==st,sector==sct,year %in% 2020:2024) %>%
ggplot(aes(x=month))+
geom_col(aes(y=gross.kWh))+
geom_point(data=with_tmy %>% filter(in.state==st,sector==sct,year %in% 2020:2024),aes(y=kwh,color=type))+
facet_wrap(~year,scales="free_y")+
ggtitle(paste(st,sct))
tail(with_tmy)
with_tmy<-bind_rows(bss_with_mult_long,
tmy_monthly %>%
mutate(type="state_monthly_tmy") %>%
select(turnover,year,month,in.state,sector,type,kwh=state_monthly_kwh))
eia_gross %>%
filter(in.state==st,sector==sct,year %in% 2020:2024) %>%
ggplot(aes(x=month))+
geom_col(aes(y=gross.kWh))+
geom_point(data=with_tmy %>% filter(in.state==st,sector==sct,year %in% 2020:2024),aes(y=kwh,color=type))+
facet_wrap(~year,scales="free_y")+
ggtitle(paste(st,sct))
eia_gross %>%
filter(in.state==st,sector==sct,year %in% 2020:2024) %>%
ggplot(aes(x=month))+
geom_col(aes(y=gross.kWh),fill="gray50")+
geom_line(data=with_tmy %>% filter(in.state==st,sector==sct,year %in% 2020:2024),aes(y=kwh,color=type))+
facet_wrap(~year,scales="free_y")+
ggtitle(paste(st,sct))
eia_gross %>%
filter(in.state==st,sector==sct,year %in% c(2020,2022,2024)) %>%
ggplot(aes(x=month))+
geom_col(aes(y=gross.kWh),fill="gray60")+
geom_line(data=with_tmy %>% filter(in.state==st,sector==sct,year %in% c(2020,2022,2024)),aes(y=kwh,color=type),size=2)+
facet_wrap(~year,scales="free_y")+
ggtitle(paste(st,sct))
eia_gross %>%
filter(in.state==st,sector==sct,year %in% c(2020,2022,2024)) %>%
ggplot(aes(x=month))+
geom_col(aes(y=gross.kWh),fill="gray60")+
geom_line(data=with_tmy %>% filter(in.state==st,sector==sct,year %in% c(2020,2022,2024)),aes(y=kwh,color=type),linewidth=1.5)+
facet_wrap(~year,scales="free_y")+
ggtitle(paste(st,sct))
for (st in c(state.abb[!(state.abb %in% c("AK","HI"))],"DC")) {
for (sct in c("res")){
eia_gross %>%
filter(in.state==st,sector==sct,year %in% c(2020,2022,2024)) %>%
ggplot(aes(x=month))+
geom_col(aes(y=gross.kWh),fill="gray60")+
geom_line(data=with_tmy %>% filter(in.state==st,sector==sct,year %in% c(2020,2022,2024)),aes(y=kwh,color=type),linewidth=1.5)+
facet_wrap(~year)+
ggtitle(paste(st,sct))
ggsave(paste0("/Users/mpigman/Documents/DECARB/pipeline/Scout results/2025-09-17/monthly mult graphs/",st,"_",sct,".jpg"),
device = "jpeg",width = 10, height =6,units = "in")
}
}
bss_monthly
tmy_monthly
monthly_ratios_tmy<-tmy_monthly %>%
inner_join(eia_gross,by=c("in.state","month","sector","year")) %>%
mutate(gross_over_bss=gross.kWh/state_monthly_kwh,
net_over_bss=sales.kWh/state_monthly_kwh)
summary(monthly_ratios_tmy)
summary(monthly_ratios) %>% filter(sector=="res") %>% summary()
monthly_ratios %>% filter(sector=="res") %>% summary()
monthly_ratios_comp<-monthly_ratios %>%
group_by(month,in.state,sector) %>%
summarize(gross_over_bss_min=min(gross_over_bss),
gross_over_bss_max=max(gross_over_bss),
gross_over_bss_mean=mean(gross_over_bss),.groups="drop") %>%
left_join(results_mults)
monthly_ratios_comp %>%
ggplot(aes(x=gross_over_bss_mean,y=mult))+
geom_point()
monthly_ratios_tmy
monthly_ratios
monthly_ratios_tmy %>% left_join(monthly_ratios,by=c("turnover","year","month","in.state","sector")) %>%
ggplot(aes(x=gross_over_bss.x,y=gross_over_bss.y))+
geom_point()
monthly_ratios_tmy %>% group_by(turnover,month,sector) %>% summarize(tmy_gross_over_bss=mean(gross_over_bss)) %>%
left_join(monthly_ratiosgroup_by(turnover,month,sector) %>% summarize(amy_gross_over_bss=mean(gross_over_bss))) %>%
ggplot(aes(x=tmy_gross_over_bss,y=amy_gross_over_bss))+
geom_point()
monthly_ratios_tmy %>% group_by(turnover,month,sector) %>% summarize(tmy_gross_over_bss=mean(gross_over_bss)) %>%
left_join(monthly_ratios %>% group_by(turnover,month,sector) %>% summarize(amy_gross_over_bss=mean(gross_over_bss))) %>%
ggplot(aes(x=tmy_gross_over_bss,y=amy_gross_over_bss))+
geom_point()
monthly_ratios_tmy %>% group_by(turnover,month,sector,in.state) %>% summarize(tmy_gross_over_bss=mean(gross_over_bss)) %>%
left_join(monthly_ratios %>% group_by(turnover,month,sector,in.state) %>% summarize(amy_gross_over_bss=mean(gross_over_bss))) %>%
ggplot(aes(x=tmy_gross_over_bss,y=amy_gross_over_bss))+
geom_point()
d<-monthly_ratios_tmy %>% group_by(turnover,month,sector,in.state) %>% summarize(tmy_gross_over_bss=mean(gross_over_bss)) %>%
left_join(monthly_ratios %>% group_by(turnover,month,sector,in.state) %>% summarize(amy_gross_over_bss=mean(gross_over_bss)))
summary(lm(tmy_gross_over_bss~amy_gross_over_bss,data=d))
d %>%
ggplot(aes(x=tmy_gross_over_bss,y=amy_gross_over_bss))+
geom_abline(slope=1,color="blue")+
geom_point()
monthly_ratios %>% group_by(turnover,month,sector,in.state) %>% summarize(amy_gross_over_bss=mean(gross_over_bss)
)
monthly_ratios %>% group_by(turnover,month,sector,in.state) %>% summarize(amy_gross_over_bss=mean(gross_over_bss)) %>%
select(sector,in.state,month,calibration_multiplier = amy_gross_over_bss) %>%
write_csv("/Users/mpigman/Documents/GitHub/BSS-Workflow/map_meas/calibration_multipliers.tsv")
monthly_ratios %>% group_by(turnover,month,sector,in.state) %>% summarize(amy_gross_over_bss=mean(gross_over_bss),.groups="drop") %>%
select(sector,in.state,month,calibration_multiplier = amy_gross_over_bss) %>%
write_csv("/Users/mpigman/Documents/GitHub/BSS-Workflow/map_meas/calibration_multipliers.tsv")
monthly_ratios %>% group_by(turnover,month,sector,in.state) %>% summarize(amy_gross_over_bss=mean(gross_over_bss),.groups="drop") %>%
select(sector,in.state,month,calibration_multiplier = amy_gross_over_bss) %>%
write_csv("/Users/mpigman/Documents/GitHub/BSS-Workflow/map_meas/calibration_multipliers.csv")
setwd("R")
list.files()
input_dir <- "generated_csvs" #directory where the csvs are stored
filename_prefix <- ""
graph_dir <- "graphs" #directory where the graphs will be written
scenarios<-c("aeo")
# scenario to get the baseline (AEO 2023) data from
scenario_for_baseline <- "aeo"
county_hourly_examples_list <- list()
for (scen in scenarios){
if (scen==scenario_for_baseline){
# county_ann_eu<-bind_rows(county_ann_eu,read_csv(paste0(input_dir,"/",scen,"_county_ann_eu.csv")))
# county_100_hrs<-bind_rows(county_100_hrs,read_csv(paste0(input_dir,"/",scen,"_county_100_hrs.csv")))
# county_monthly_maxes<-bind_rows(county_monthly_maxes,read_csv(paste0(input_dir,"/",scen,"_county_monthly_maxes.csv")))
county_hourly_examples_list[[scen]]<-read_csv(paste0(input_dir,"/",filename_prefix,scen,"_county_hourly_examples.csv"))
} else{
# county_ann_eu<-bind_rows(county_ann_eu,read_csv(paste0(input_dir,"/",scen,"_county_ann_eu.csv"))%>% filter(turnover!="baseline"))
# county_100_hrs<-bind_rows(county_100_hrs,read_csv(paste0(input_dir,"/",scen,"_county_100_hrs.csv"))%>% filter(turnover!="baseline"))
# county_monthly_maxes<-bind_rows(county_monthly_maxes,read_csv(paste0(input_dir,"/",scen,"_county_monthly_maxes.csv"))%>% filter(turnover!="baseline"))
county_hourly_examples_list[[scen]]<-read_csv(paste0(input_dir,"/",filename_prefix,scen,"_county_hourly_examples.csv"))
}
}
county_hourly_examples_list
tail(county_hourly_examples_list[[1]])
unique(county_hourly_examples_list[[1]]$year)
#sample sizes and county names
ns<-read_csv("../map_meas/resstock_ns.csv")
i<1
i<-1
rename(county_hourly_examples_list[[1]],`date`=`day`)
county_hourly_examples_list[[1]]
county_hourly_examples_list[[1]]<-rename(county_hourly_examples_list[[1]],`date`=`day`)
county_hourly_examples_list[[1]]
with_ex_labels<-county_hourly_examples_list[[i]]%>%
filter(year %in% c(2024,2050)) %>%
left_join(ns %>% select(in.county,county_name),by="in.county") %>%
mutate(example_label=paste0(example_type,": ",county_name),
month=month(timestamp_hour),day_of_month=day(date))
county_hourly_examples_list <- list()
for (scen in scenarios){
if (scen==scenario_for_baseline){
# county_ann_eu<-bind_rows(county_ann_eu,read_csv(paste0(input_dir,"/",scen,"_county_ann_eu.csv")))
# county_100_hrs<-bind_rows(county_100_hrs,read_csv(paste0(input_dir,"/",scen,"_county_100_hrs.csv")))
# county_monthly_maxes<-bind_rows(county_monthly_maxes,read_csv(paste0(input_dir,"/",scen,"_county_monthly_maxes.csv")))
county_hourly_examples_list[[scen]]<-read_csv(paste0(input_dir,"/",filename_prefix,scen,"_county_hourly_examples.csv"))
} else{
# county_ann_eu<-bind_rows(county_ann_eu,read_csv(paste0(input_dir,"/",scen,"_county_ann_eu.csv"))%>% filter(turnover!="baseline"))
# county_100_hrs<-bind_rows(county_100_hrs,read_csv(paste0(input_dir,"/",scen,"_county_100_hrs.csv"))%>% filter(turnover!="baseline"))
# county_monthly_maxes<-bind_rows(county_monthly_maxes,read_csv(paste0(input_dir,"/",scen,"_county_monthly_maxes.csv"))%>% filter(turnover!="baseline"))
county_hourly_examples_list[[scen]]<-read_csv(paste0(input_dir,"/",filename_prefix,scen,"_county_hourly_examples.csv"))
}
}
head(county_hourly_examples_list[[1]])
county_hourly_examples_list[[i]]%>%
filter(year %in% c(2024,2050)) %>%
left_join(ns %>% select(in.county,county_name),by="in.county") %>%
mutate(example_label=paste0(example_type,": ",county_name),
day_of_month=day(date))
nrow(county_hourly_examples_list[[1]])
24*37*12
county_hourly_examples_list <- list()
for (scen in scenarios){
if (scen==scenario_for_baseline){
# county_ann_eu<-bind_rows(county_ann_eu,read_csv(paste0(input_dir,"/",scen,"_county_ann_eu.csv")))
# county_100_hrs<-bind_rows(county_100_hrs,read_csv(paste0(input_dir,"/",scen,"_county_100_hrs.csv")))
# county_monthly_maxes<-bind_rows(county_monthly_maxes,read_csv(paste0(input_dir,"/",scen,"_county_monthly_maxes.csv")))
county_hourly_examples_list[[scen]]<-read_csv(paste0(input_dir,"/",filename_prefix,scen,"_county_hourly_examples.csv"))
} else{
# county_ann_eu<-bind_rows(county_ann_eu,read_csv(paste0(input_dir,"/",scen,"_county_ann_eu.csv"))%>% filter(turnover!="baseline"))
# county_100_hrs<-bind_rows(county_100_hrs,read_csv(paste0(input_dir,"/",scen,"_county_100_hrs.csv"))%>% filter(turnover!="baseline"))
# county_monthly_maxes<-bind_rows(county_monthly_maxes,read_csv(paste0(input_dir,"/",scen,"_county_monthly_maxes.csv"))%>% filter(turnover!="baseline"))
county_hourly_examples_list[[scen]]<-read_csv(paste0(input_dir,"/",filename_prefix,scen,"_county_hourly_examples.csv"))
}
}
head(county_hourly_examples_list[[1]])
nrow(county_hourly_examples_list[[1]])
953856/24
953856/24/36
953856/24/36/12/2/2
a<-county_hourly_examples_list[[1]]
nrow(a %>% filter(in.county=="G0400130"))
unique((a %>% filter(in.county=="G0400130"))$day_type)
unique((a %>% filter(in.county=="G0400130"))$month)
unique((a %>% filter(in.county=="G0400130"))$hour_of_day)
unique((a %>% filter(in.county=="G0400130"))$year)
unique((a %>% filter(in.county=="G0400130"))$turnover)
24*12*3*2*2
79488/3456
(a %>% filter(in.county=="G0400130",month==1,hour_of_day==2,year==2024,turnover=="aeo"))
(a %>% filter(in.county=="G0400130",month==1,hour_of_day==2,year==2024,turnover=="aeo")) %>% arrange(county_hourly_kwh) %>% print(n=70)
county_hourly_examples_list <- list()
for (scen in scenarios){
if (scen==scenario_for_baseline){
# county_ann_eu<-bind_rows(county_ann_eu,read_csv(paste0(input_dir,"/",scen,"_county_ann_eu.csv")))
# county_100_hrs<-bind_rows(county_100_hrs,read_csv(paste0(input_dir,"/",scen,"_county_100_hrs.csv")))
# county_monthly_maxes<-bind_rows(county_monthly_maxes,read_csv(paste0(input_dir,"/",scen,"_county_monthly_maxes.csv")))
county_hourly_examples_list[[scen]]<-read_csv(paste0(input_dir,"/",filename_prefix,scen,"_county_hourly_examples.csv"))
} else{
# county_ann_eu<-bind_rows(county_ann_eu,read_csv(paste0(input_dir,"/",scen,"_county_ann_eu.csv"))%>% filter(turnover!="baseline"))
# county_100_hrs<-bind_rows(county_100_hrs,read_csv(paste0(input_dir,"/",scen,"_county_100_hrs.csv"))%>% filter(turnover!="baseline"))
# county_monthly_maxes<-bind_rows(county_monthly_maxes,read_csv(paste0(input_dir,"/",scen,"_county_monthly_maxes.csv"))%>% filter(turnover!="baseline"))
county_hourly_examples_list[[scen]]<-read_csv(paste0(input_dir,"/",filename_prefix,scen,"_county_hourly_examples.csv"))
}
}
with_ex_labels<-county_hourly_examples_list[[i]]%>%
filter(year %in% c(2024,2050)) %>%
left_join(ns %>% select(in.county,county_name),by="in.county") %>%
mutate(example_label=paste0(example_type,": ",county_name),
day_of_month=day(date))
with_ex_labels
69120/24/3/12/2/2/2
unique(with_ex_labels$in.county)
length(unique(with_ex_labels$in.county))
12*3*12*2*2*2*24
12*24*2*2*60
with_ex_labels<-county_hourly_examples_list[[i]]%>%
filter(peak_source!="baseline",day_type=="monthly_peak_day") %>%
left_join(ns %>% select(in.county,county_name),by="in.county") %>%
mutate(example_label=paste0(example_type,": ",county_name),
day_of_month=day(date))
with_ex_labels<-county_hourly_examples_list[[i]]%>%
filter(peak_source_turnover!="baseline",day_type=="monthly_peak_day") %>%
left_join(ns %>% select(in.county,county_name),by="in.county") %>%
mutate(example_label=paste0(example_type,": ",county_name),
day_of_month=day(date))
with_ex_labels
maxes<-with_ex_labels %>% filter(turnover!="baseline") %>%
group_by(year,in.county,example_label) %>%
filter(county_hourly_kwh==max(county_hourly_kwh)) %>% ungroup()
maxes
day_labels<-with_ex_labels %>%
right_join(maxes %>% select(year, date, example_label, in.county),by=c("year", "date", "example_label", "in.county")) %>%
select(in.county,year,month,day_of_month,example_label,turnover) %>% unique() %>%
mutate(day_label=paste(month,day_of_month,sep="/"),x=if_else(year==2024,3,13))
day_labels
psample<-with_ex_labels %>%
right_join(maxes %>% select(year, date, example_label, in.county),by=c("year", "date", "example_label", "in.county")) %>%
mutate(turnover=factor(turnover,levels=c("baseline",names(to[scenarios])),ordered=T)) %>%
ggplot(aes(color=factor(year)))+
geom_line(aes(x=hour_of_day,y=county_hourly_kwh/1000,linetype=turnover))+
xlab("EST")+
geom_text(data=day_labels,y=-Inf,vjust=-.5,aes(x=x,label=day_label),show.legend = F,size=8) +
scale_y_continuous(name="MWh",labels=comma_format(),limits=c(0,NA))+
scale_color_brewer(name="",palette = "Dark2")+
scale_linetype(name="",labels=to)+
facet_wrap(~example_label,scales="free",ncol=2)+
ggtitle("Day with the Peak Hour")
psample
county_hourly_examples_list[[i]]
cty<-"G0400130"
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, peak_source_turnover!="baseline") %>%
ggplot(aes(x=hour_of_day,y=county_hourly_kwh,color=factor(year),linetype=turnover,group=day_type))+
geom_line()+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, peak_source_turnover!="baseline") %>%
ggplot(aes(x=hour_of_day,y=county_hourly_kwh,linetype=turnover,group=day_type))+
geom_line()+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, peak_source_turnover!="baseline") %>%
ggplot(aes(x=hour_of_day,y=county_hourly_kwh,color=factor(year),linetype=turnover))+
geom_line()+
facet_wrap(day_type~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover))) %>%
ggplot(aes(x=hour_of_day,y=county_hourly_kwh,color=factor(year),linetype=turnover))+
geom_line()+
facet_wrap(day_type~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover))) %>%
ggplot(aes(x=hour_of_day,y=county_hourly_kwh,color=factor(year),linetype=turnover,group=day_type))+
geom_line()+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover))) %>%
ggplot(aes(x=hour_of_day,y=county_hourly_kwh,color=factor(year),linetype=turnover,linewidth=day_type))+
geom_line()+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover))) %>%
ggplot(aes(x=hour_of_day,y=county_hourly_kwh,color=factor(year),linetype=day_type))+
geom_line()+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline")
?pivot_wider
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover"))
ggplot(aes(x=hour_of_day,color=factor(year),linetype=day_type))+
geom_ribbon(aes(ymin=monthly_min_peak_day,ymax=monthly_peak_day,fill=factor(year)),alpha=.8)+
geom_line(aes(y=county_hourly_kwh,color=factor("year")))+
facet_wrap(~month)
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day,ymax=monthly_peak_day,fill=factor(year)),alpha=.8)+
geom_line(aes(y=county_hourly_kwh,color=factor("year")))+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day,ymax=monthly_peak_day,fill=factor(year)),alpha=.8)+
geom_line(aes(y=county_hourly_kwh,color=factor("year")))+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day,ymax=monthly_peak_day,fill=factor(year)),alpha=.8)+
geom_line(aes(y=monthly_mean,color=factor("year")))+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day,ymax=monthly_peak_day,fill=factor(year)),alpha=.8)+
geom_line(aes(y=monthly_mean,color=factor(year)))+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day,ymax=monthly_peak_day,fill=factor(year)),alpha=.9)+
geom_line(aes(y=monthly_mean,color=factor(year)))+
facet_wrap(~month)
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day,ymax=monthly_peak_day,fill=factor(year)),alpha=.4)+
geom_line(aes(y=monthly_mean,color=factor(year)))+
facet_wrap(~month)
example_labels<-county_hourly_examples_list[[i]]%>% select(in.county,example_type) %>% unique() %>%
left_join(ns %>% select(in.county,county_name),by="in.county") %>%
mutate(example_label=paste0(example_type,": ",county_name))
example_labels
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day/1000,ymax=monthly_peak_day/1000,fill=factor(year)),alpha=.4)+
geom_line(aes(y=monthly_mean/1000,color=factor(year)))+
xlab("EST")+
scale_y_continuous(name="MWh",labels=comma_format(),limits=c(0,NA))+
scale_color_brewer(name="",palette = "Dark2")+
scale_fill_brewer(name="",palette = "Dark2")+
facet_wrap(~month)+
ggtitle((example_labels %>% filter(in.county==cty))$example_label)
psample
names(county_hourly_examples_list)
to
to[names(county_hourly_examples_list)[[i]]]
county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day/1000,ymax=monthly_peak_day/1000,fill=factor(year)),alpha=.4)+
geom_line(aes(y=monthly_mean/1000,color=factor(year)))+
xlab("EST")+
scale_y_continuous(name="MWh",labels=comma_format(),limits=c(0,NA))+
scale_color_brewer(name="",palette = "Dark2")+
scale_fill_brewer(name="",palette = "Dark2")+
facet_wrap(~month)+
ggtitle(paste0(to[names(county_hourly_examples_list)[[i]]],": Mean, Day with Highest Peak, Day with Lowest Peak by Month"),
subtitle = (example_labels %>% filter(in.county==cty))$example_label)
paste0(graph_dir,"/example_by_month_",names(county_hourly_examples_list)[i],"_",(example_labels %>% filter(in.county==cty))$county_name,".jpg")
for (i in 1:length(county_hourly_examples_list)){
# for (cty in unique(county_hourly_examples_list[[i]]$in.county)){
for (cty in "G0400130"){
monthly_examples<-county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day/1000,ymax=monthly_peak_day/1000,fill=factor(year)),alpha=.4)+
geom_line(aes(y=monthly_mean/1000,color=factor(year)))+
xlab("EST")+
scale_y_continuous(name="MWh",labels=comma_format(),limits=c(0,NA))+
scale_color_brewer(name="",palette = "Dark2")+
scale_fill_brewer(name="",palette = "Dark2")+
facet_wrap(~month)+
ggtitle(paste0(to[names(county_hourly_examples_list)[[i]]],": Mean, Day with Highest Peak, Day with Lowest Peak by Month"),
subtitle = (example_labels %>% filter(in.county==cty))$example_label)
save_plot(paste0(graph_dir,"/example_by_month_",names(county_hourly_examples_list)[i],"_",(example_labels %>% filter(in.county==cty))$county_name,".jpg"),
monthly_examples,base_height = 10,base_width = 8,bg="white")
}
}
for (i in 1:length(county_hourly_examples_list)){
# for (cty in unique(county_hourly_examples_list[[i]]$in.county)){
for (cty in "G0400130"){
monthly_examples<-county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day/1000,ymax=monthly_peak_day/1000,fill=factor(year)),alpha=.4)+
geom_line(aes(y=monthly_mean/1000,color=factor(year)))+
xlab("EST")+
scale_y_continuous(name="MWh",labels=comma_format(),limits=c(0,NA))+
scale_color_brewer(name="",palette = "Dark2")+
scale_fill_brewer(name="",palette = "Dark2")+
facet_wrap(~month)+
ggtitle(paste0(to[names(county_hourly_examples_list)[[i]]],": Mean, Day with Highest Peak, Day with Lowest Peak by Month"),
subtitle = (example_labels %>% filter(in.county==cty))$example_label)
save_plot(paste0(graph_dir,"/example_by_month_",names(county_hourly_examples_list)[i],"_",(example_labels %>% filter(in.county==cty))$county_name,".jpg"),
monthly_examples,base_height = 8,base_width = 8,bg="white")
}
}
for (i in 1:length(county_hourly_examples_list)){
# for (cty in unique(county_hourly_examples_list[[i]]$in.county)){
for (cty in "G0400130"){
monthly_examples<-county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day/1000,ymax=monthly_peak_day/1000,fill=factor(year)),alpha=.4)+
geom_line(aes(y=monthly_mean/1000,color=factor(year)))+
xlab("EST")+
scale_y_continuous(name="MWh",labels=comma_format(),limits=c(0,NA))+
scale_color_brewer(name="",palette = "Dark2")+
scale_fill_brewer(name="",palette = "Dark2")+
facet_wrap(~month)+
ggtitle(paste0(to[names(county_hourly_examples_list)[[i]]],": Mean, Day with Highest Peak, Day with Lowest Peak by Month"),
subtitle = (example_labels %>% filter(in.county==cty))$example_label)
save_plot(paste0(graph_dir,"/example_by_month_",names(county_hourly_examples_list)[i],"_",(example_labels %>% filter(in.county==cty))$county_name,".jpg"),
monthly_examples,base_height = 6,base_width = 8,bg="white")
}
}
rm(cty)
rm(i)
for (i in 1:length(county_hourly_examples_list)){
for (cty in unique(county_hourly_examples_list[[i]]$in.county)){
# for (cty in "G0400130"){
monthly_examples<-county_hourly_examples_list[[i]] %>%
filter(in.county==cty, (peak_source_turnover!="baseline" | is.na(peak_source_turnover)), turnover!="baseline") %>%
pivot_wider(names_from="day_type",values_from="county_hourly_kwh",id_cols=c("year","month","hour_of_day","turnover")) %>%
ggplot(aes(x=hour_of_day))+
geom_ribbon(aes(ymin=monthly_min_peak_day/1000,ymax=monthly_peak_day/1000,fill=factor(year)),alpha=.4)+
geom_line(aes(y=monthly_mean/1000,color=factor(year)))+
xlab("EST")+
scale_y_continuous(name="MWh",labels=comma_format(),limits=c(0,NA))+
scale_color_brewer(name="",palette = "Dark2")+
scale_fill_brewer(name="",palette = "Dark2")+
facet_wrap(~month)+
ggtitle(paste0(to[names(county_hourly_examples_list)[[i]]],": Mean, Day with Highest Peak, Day with Lowest Peak by Month"),
subtitle = (example_labels %>% filter(in.county==cty))$example_label)
save_plot(paste0(graph_dir,"/example_by_month_",names(county_hourly_examples_list)[i],"_",(example_labels %>% filter(in.county==cty))$county_name,".jpg"),
monthly_examples,base_height = 7,base_width = 8,bg="white")
}
}
